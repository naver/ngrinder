<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
   
	<changeSet author="initialDB" id="3" dbms="h2">
		<validCheckSum/>
		<preConditions onFail="MARK_RAN">
		 	<not>
            	<tableExists tableName="TAG"/>
         	</not>
        </preConditions>
        <comment>DB(H2) initialization.</comment>
	    <sql>
	    	drop table AGENT if exists;
		
		    drop table NUSER if exists;
		
		    drop table PERF_TEST if exists;
		
		    drop table PERF_TEST_TAG if exists;
		
		    drop table TAG if exists;
		
		    drop table system_monitor if exists;
		
		    create table AGENT (
		        id bigint generated by default as identity unique,
		        approved char(255) not null,
		        hostName varchar(255),
		        ip varchar(255),
		        region varchar(255),
		        primary key (id)
		    );
		
		    create table NUSER (
		        id bigint generated by default as identity unique,
		        created_date timestamp,
		        last_modified_date timestamp,
		        authentication_provider_class varchar(255),
		        description varchar(255),
		        email varchar(255),
		        enabled boolean not null,
		        is_external boolean,
		        mobile_phone varchar(255),
		        password varchar(255),
		        role_name varchar(255) not null,
		        timeZone varchar(255),
		        user_id varchar(255) not null unique,
		        user_language varchar(255),
		        user_name varchar(255),
		        created_user bigint,
		        last_modified_user bigint,
		        primary key (id)
		    );
		
		    create table PERF_TEST (
		        id bigint generated by default as identity unique,
		        created_date timestamp,
		        last_modified_date timestamp,
		        agent_count integer,
		        description varchar(2048),
		        distribution_path varchar(255),
		        duration bigint,
		        errors integer,
		        finish_time timestamp,
		        ignore_sample_count integer,
		        init_processes integer,
		        init_sleep_time integer,
		        last_progress_message varchar(2048),
		        mean_test_time double,
		        peak_tps double,
		        port integer,
		        process_increment integer,
		        process_increment_interval integer,
		        processes integer,
		        progress_message varchar(2048),
		        run_count integer,
		        scheduled_time timestamp,
		        script_name varchar(255),
		        script_revistion bigint,
		        send_mail char(255),
		        start_time timestamp,
		        status varchar(255),
		        stop_request char(255),
		        tag_string varchar(255),
		        target_hosts varchar(255),
		        test_comment varchar(2048),
		        test_error_cause varchar(255),
		        name varchar(255),
		        test_time_standard_deviation double,
		        tests integer,
		        threads integer,
		        threshold varchar(255),
		        tps double,
		        use_rampup char(255),
		        vuser_per_agent integer,
		        created_user bigint,
		        last_modified_user bigint,
		        primary key (id)
		    );
		
		    create table PERF_TEST_TAG (
		        perf_test_id bigint not null,
		        tag_id bigint not null,
		        primary key (perf_test_id, tag_id)
		    );
		
		    create table TAG (
		        id bigint generated by default as identity unique,
		        created_date timestamp,
		        last_modified_date timestamp,
		        tagValue varchar(255),
		        created_user bigint,
		        last_modified_user bigint,
		        primary key (id)
		    );
		
		    create table system_monitor (
		        id bigint generated by default as identity unique,
		        collect_time bigint,
		        cpu_used_percentage double,
		        crtime varchar(255),
		        free_memory bigint,
		        idle_cpu_value double,
		        ip varchar(255),
		        monitor_key varchar(255),
		        load_avg_1 double,
		        load_avg_15 double,
		        load_avg_5 double,
		        message varchar(255),
		        port integer not null,
		        system varchar(255),
		        total_cpu_value double,
		        total_memory bigint,
		        primary key (id)
		    );
		
		    create index last_modified_user_index_NUSER on NUSER (last_modified_user);
		
		    create index created_user_index on NUSER (created_user);
		
		    alter table NUSER 
		        add constraint FK4730D19BAFCD683 
		        foreign key (created_user) 
		        references NUSER;
		
		    alter table NUSER 
		        add constraint FK4730D191B90BD59 
		        foreign key (last_modified_user) 
		        references NUSER;
		
		    create index last_modified_user_index_PERF_TEST on PERF_TEST (last_modified_user);
		
		    create index created_user_index_PERF_TEST on PERF_TEST (created_user);
		
		    create index scheduled_time_index on PERF_TEST (scheduled_time);
		
		    alter table PERF_TEST 
		        add constraint FKC3A7F428BAFCD683 
		        foreign key (created_user) 
		        references NUSER;
		
		    alter table PERF_TEST 
		        add constraint FKC3A7F4281B90BD59 
		        foreign key (last_modified_user) 
		        references NUSER;
		
		    alter table PERF_TEST_TAG 
		        add constraint FK8EE12E3AD3184A3 
		        foreign key (perf_test_id) 
		        references PERF_TEST;
		
		    alter table PERF_TEST_TAG 
		        add constraint FK8EE12E317FA08C4 
		        foreign key (tag_id) 
		        references TAG;
		
		    create index last_modified_user_index_TAG on TAG (last_modified_user);
		
		    create index created_user_index_TAG on TAG (created_user);
		
		    alter table TAG 
		        add constraint FK1437ABAFCD683 
		        foreign key (created_user) 
		        references NUSER;
		
		    alter table TAG 
		        add constraint FK1437A1B90BD59 
		        foreign key (last_modified_user) 
		        references NUSER;
		
		    create index monitor_key_index on system_monitor (monitor_key);
		
		    create index collect_time_index on system_monitor (collect_time);
		
		    create index ip_index on system_monitor (ip);
						   
    			
	    </sql>
    </changeSet>
</databaseChangeLog>